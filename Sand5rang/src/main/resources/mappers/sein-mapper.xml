<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="seinMapper">

	<resultMap type="com.s5.sand5rang.sein.vo.Ingredient" id="IngredientResultSet">
		<result column="ING_NO" property="ingNo"/>
		<result column="ING_NAME" property="ingName"/>
		<result column="PRICE" property="price"/>
		<result column="EXPIRATION" property="expiration"/>
		<result column="ING_TYPE" property="ingType"/>
	</resultMap>
	
	<resultMap type="com.s5.sand5rang.sein.vo.Order" id="TodyOrderResultSet">
		<result column="IND_NO" property="indNo"/>
		<result column="COUNT" property="count"/>
		<result column="IND_DATE" property="indDate"/>
		<result column="TOTAL" property="total"/>
		<result column="STATUS" property="status"/>
		<result column="STORE_ID" property="storeId"/>
		<result column="ING_NO" property="ingNo"/>
		<result column="ING_NAME" property="ingName"/>
		<result column="ING_TYPE" property="ingType"/>
		<result column="PRICE" property="price"/>
		<result column="ROWNUM" property="rowNo"/>
		<result column="'B'" property="b"/>
		<result column="'V'" property="v"/>
		<result column="'C'" property="c"/>
		<result column="'M'" property="m"/>
		<result column="'S'" property="s"/>
	</resultMap>

	<!-- 원재료 전체 조회 select -->
	<!-- <select id="selectIngredient" resultMap="IngredientResultSet">
		SELECT ING_NO, ING_NAME, PRICE, EXPIRATION, ING_TYPE 
		FROM INGREDIENT
	</select> -->
	
	<!-- 발주 체크 select -->
	<select id="selectOrder" resultType="_int">
		SELECT COUNT(IND_DATE) FROM INDENT
		WHERE STORE_ID = 'GUM01' AND
		      TO_CHAR(IND_DATE, 'YY-MM-DD') = TO_CHAR(SYSDATE, 'YY-MM-DD')
		GROUP BY IND_DATE
	</select>
	
	<!-- 발주insert -->
	<insert id="insertOrder" parameterType="order">
		INSERT INTO INDENT(IND_NO, 
                    		COUNT, 
                    		IND_DATE, 
                    		TOTAL, 
                    		STATUS,
                    		STORE_ID,
                    		ING_NO)  
					VALUES(SEQ_INDENTNO.NEXTVAL, 
						 #{count}, 
						 SYSDATE, 
						 #{total}, 
						 #{status}, 
						 'GUM01', 
						 #{ingNo})
	</insert>
	
	<!-- 발주상세조회 select -->
	<select id="selectTodayOrder" resultMap="TodyOrderResultSet">
		SELECT IND_NO, COUNT, IND_DATE, TOTAL, STATUS, STORE_ID, ING_NO, ING_NAME, ING_TYPE
		FROM INDENT JOIN INGREDIENT USING(ING_NO) 
		WHERE STORE_ID = 'GUM01' 
		      AND TO_CHAR(IND_DATE, 'YY-MM-DD') = TO_CHAR(SYSDATE, 'YY-MM-DD') 
		ORDER BY ING_NO ASC
	</select>

	<!-- 발주전체조회 select -->
	<select id="selectAllOrderList" resultMap="TodyOrderResultSet">
		SELECT ROWNUM, A.* 
		FROM(SELECT *
		      FROM (SELECT IND_DATE, ING_TYPE, STATUS, COUNT 
		            FROM INDENT JOIN INGREDIENT USING(ING_NO))
		      PIVOT (SUM(COUNT) FOR ING_TYPE IN('B', 'V', 'C', 'M', 'S'))) A
	</select>
	
	<!-- 자동발주신청 select -->
	<select id="selectAutoOrder" resultMap="TodyOrderResultSet">
	     SELECT TO_DATE(IND_DATE, 'YY-MM-DD HH24:MI:SS') IND_DATE, IND_NO, COUNT, TOTAL, STATUS, STORE_ID, ING_NO
		 FROM INDENT 
		 WHERE STORE_ID = 'GUM01' 
		 AND TO_CHAR(IND_DATE, 'YY-MM-DD HH24:MI:SS') BETWEEN TO_CHAR(TO_DATE(SYSDATE, 'YY-MM-DD HH24:MI:SS') - INTERVAL '33' HOUR, 'YY-MM-DD HH24:MI:SS') AND
		                         TO_CHAR(TO_DATE(SYSDATE, 'YY-MM-DD HH24:MI:SS') + INTERVAL '15' HOUR, 'YY-MM-DD HH24:MI:SS')
		 AND STATUS ='AB'
	</select>
	
	<!-- 가맹점 발주대기 상태의 원재료 list select -->
	<select id="selectOrder2" resultMap="TodyOrderResultSet">
		SELECT IND_NO, COUNT, IND_DATE, TOTAL, STATUS, STORE_ID, ING_NO, ING_NAME, PRICE
		FROM INDENT JOIN INGREDIENT USING(ING_NO) 
		WHERE STORE_ID = 'GUM01' AND 
		      TO_CHAR(IND_DATE, 'YY-MM-DD') = TO_CHAR(SYSDATE, 'YY-MM-DD') AND 
		      STATUS LIKE '%B' 
		ORDER BY ING_NO
	</select>
	
</mapper>
